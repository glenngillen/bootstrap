#!/bin/bash
type gcc >/dev/null 2>/dev/null || {
  echo "Installing GCC"
  curl -L -o osx-gcc-installer.pkg https://github.com/downloads/kennethreitz/osx-gcc-installer/GCC-10.7-v2.pkg
  sudo installer -pkg ./osx-gcc-installer.pkg -target "/"
  rm osx-gcc-installer.pkg
}
echo "GCC Installed. Now go install XCode from the app store, we'll wait."
echo "[Enter Y  when done]"
while read aok; do
  if [[ $aok == "Y" || $aok == "y" ]]; then
    break;
  else
    echo "GCC Installed. Now go install XCode from the app store, we'll wait."
    echo "[Press enter when done]";
  fi
done
echo "Did you actually run XCode? It doesn't install until you run it the first time"
echo "[Enter Y  when done]"
while read aok; do
  if [[ $aok == "Y" || $aok == "y" ]]; then
    break;
  else
    echo "Did you actually run XCode? It doesn't install until you run it the first time"
    echo "[Press enter when done]";
  fi
done
echo "Did you install the Command Line Tools? Go to the download preferences in XCode"
echo "[Enter Y  when done]"
while read aok; do
  if [[ $aok == "Y" || $aok == "y" ]]; then
    break;
  else
    echo "Did you install the Command Line Tools? Go to the download preferences in XCode"
    echo "[Press enter when done]";
  fi
done
if [ ! -f ~/.rvm/scripts/rvm ]; then
  echo "Installing RVM"
  curl -L -o rvm-installer https://raw.github.com/wayneeseguin/rvm/master/binscripts/rvm-installer
  chmod +x ./rvm-installer
  ./rvm-installer
  rm rvm-installer
fi
source ~/.bash_profile
rvm 1.9.3
if [ $? -ne 0 ]; then
  echo "Installing Ruby"
  rvm install 1.9.3
  rvm 1.9.3 --default
  rvm 1.9.3
  gem install bundler --no-ri --no-rdoc
  cd ~
fi
if [ ! -f ~/Development/bootstrap/Gemfile ]; then
  echo "Installing bootstrap and chef scripts"
  mkdir -p ~/Development/bootstrap
  cd ~/Development
  curl -L -o bootstrap.zip https://github.com/glenngillen/bootstrap/zipball/master
  unzip bootstrap.zip -d bootstrap
  mv bootstrap/glenngillen-bootstrap-*/* bootstrap/
  mv bootstrap/glenngillen-bootstrap-*/.* bootstrap/
  rm -rf bootstrap/glenngillen-bootstrap-*
fi
cd ~/Development/bootstrap
rvm use --create 1.9.3@bootstrap
bundle install
echo "Go install Dropbox"
echo "[Enter Y  when done]"
while read aok; do
  if [[ $aok == "Y" || $aok == "y" ]]; then
    break;
  else
    echo "Go install Dropbox"
    echo "[Press enter when done]";
  fi
done
if [ ! -d ~/Development/bootstrap/vendored_cookbooks/homebrew ]; then
  curl -L -o homebrew.zip https://github.com/opscode-cookbooks/homebrew/archive/master.zip
  unzip homebrew.zip -d vendored_cookbooks
  mv vendored_cookbooks/homebrew-master vendored_cookbooks/homebrew
  rm -rf homebrew.zip
fi
echo ""
echo ""
echo ""
echo ""
echo "Open a new terminal session and run 'bundle exec rake converge[type]' to setup"
echo "Where type is something like: development, oncall, etc."
echo ""
echo "If you get an error about /Developer not existing you probably need to 'sudo xcode-select -switch /Applications/Xcode.app/Contents/Developer'"
echo "Until I find a better way, if you're getting YAML errors re-install ruby 1.9.3:"
echo "rvm reinstall 1.9.3 --with-libyaml-dir=/usr/local"
echo ""
